## 断言

**形如 res,ok:=x.(T) 的表达式为类型断言，其中 x 必须是接口（空接口亦可），T 可以是接口或具体类型，ok 表示断言是否成功，若成功则 res 的值为 x 的值，类型为 x 的类型，否则 panic。** 

```go
type User struct {
	Name string
	Age int
	Sex bool
}

type Student struct {
	Class string
	User
}

func (user User)SayName(name string){
	fmt.Println("my name is", name)
}

func main() {
    
	usr := User{
		Name: "Ohiua",
		Age:  24,
		Sex:  true,
	}

	stu := Student{
		Class: "ELE01",
		User:  usr,
	}

	check(stu)
	check(usr)
}

// 将接口断言为原始类型
func check(v interface{}){
	switch v.(type) {
	case User:
		fmt.Printf("%s:", v.(User).Name)
		fmt.Println("a User.")
	case Student:
		fmt.Printf("%s:", v.(Student).Name)
		fmt.Println("a Student.")
	}
}
```

## 反射

Golang提供了一种机制，在编译时**不知道类型的情况下**，可**更新变量**、运行时**查看值**、**调用方法**以及直接对他们的**布局进行操作**的机制，称为反射。 

**方法：**

- 获取输入参数接口中的数据的类型：```reflect.TypeOf()```

- 获取输入参数接口中的数据的值：```reflect.ValueOf()```
- 获取输入参数接口中的数据的属性的个数：```reflect.TypeOf().NumField()```
- 按索引获取输入参数接口中的数据的属性的值：```reflect.ValueOf().Field()```
- 按属性名获取输入参数接口中的数据的属性的值：```reflect.ValueOf().FieldByName()```
- 按层级获取输入参数接口中的数据的属性的值：```reflect.ValueOf().FieldByIndex([]int{0,1})```
- 判断输入参数接口中的数据的类型：```reflect.TypeOf().Kind()```
- 获取原始数据并操作：```reflect.ValueOf().Elem()```
- 获取方法并调用：```reflect.ValueOf().Method().Call([]reflect.Value{reflect.ValueOf)```

**示例1：**

```go
func main() {

	//balabala...

	check(stu)
}

func check(inter interface{}){
	t := reflect.TypeOf(inter)		// 获取输入参数接口中的数据的类型
	v := reflect.ValueOf(inter)		// 获取输入参数接口中的数据的值

	//t.NumField()：获取输入参数接口中的数据的属性的个数
	for i := 0; i < t.NumField(); i++ {
		fmt.Println(v.Field(i))		// 按索引获取输入参数接口中的数据的属性的值
	}

	fmt.Println(t, v)
	fmt.Println(v.FieldByName("Class"))	// 通过属性名获取，对于匿名属性束手无策
	fmt.Println(v.FieldByIndex([]int{1}))		// 通过层级获取匿名属性User的值

	ty := t.Kind()
	if ty == reflect.Struct{
		fmt.Println("type of arg is struct.")
	}else if ty == reflect.String {
		fmt.Println("type of arg is string.")
	}else if ty == reflect.Int{
		fmt.Println("type of arg is int.")
	}else {
		fmt.Printf("type of arg is other %v.\n", ty)
	}
}
```

**示例2：**获取原始数据并操作。

```go
func main() {

	//balabala...

	check(&stu)
	fmt.Println(stu)
}

func check(inter interface{}){
	e := reflect.ValueOf(inter).Elem()
	e.FieldByName("Class").SetString("ELE1")
}
```

**示例3：**获取方法并调用。

```go
func main() {

	//balabala...

	check(stu)
}

func check(inter interface{}){
	v := reflect.ValueOf(inter)
	m := v.Method(0)
	m.Call([]reflect.Value{reflect.ValueOf("Zh.Ohiua")})
}
```

